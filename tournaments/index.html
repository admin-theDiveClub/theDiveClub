<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Bootstrap CSS -->     
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Import Supabase resources via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>    
    <!-- Browser Helpers -->
    <script src="../scripts/browserHelpers/script_mobile_hideToolBar.js"></script>
    <!--Custom CSS-->
    <link href="../stylesheets/stylesheet_main.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/leader-line@1.0.7/leader-line.min.js"></script>


    <title>TDC: Tournament</title>
    <link rel="icon" href="../resources/icon_TDC.ico">
</head>

<body>
    <div id="visualization-container" ></div>
    <div id="component-nav-bar"></div>

    <div id="component-nav-menu"></div>

    <div id="component-profile-menu"></div>

    <div id="component-login"></div>

    <div class="main">
        <!-- Edit Tournament Info -->
        <div class="card" id="t-info-edit" style="display: none;">
            <div class="card-header">
                <h5 class="card-title">Edit Tournament Info</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div id="t-info-icon" style="height:100%; display:flex; align-items:center; justify-content:center;">
                            <img id="t-icon-img" src="../resources/icon_theDiveClub_alpha.svg" alt="Tournament Icon">
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div id="t-info-content">
                            <div>
                                <label for="t-info-name" class="form-label t-info-label">Tournament Name</label>
                                <input id="t-info-name" class="form-control t-info-item" type="text" placeholder="Tournament Name">
                            </div>

                            <div>
                                <label for="t-info-max-entries" class="form-label t-info-label">Max Entries</label>
                                <input id="t-info-max-entries" class="form-control t-info-item" type="number" min="1" step="1" placeholder="0">
                            </div>

                            <div>
                                <label for="t-info-format" class="form-label t-info-label">Format</label>
                                <input id="t-info-format" class="form-control t-info-item" type="text" placeholder="Format" disabled>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <label for="t-info-date" class="form-label t-info-label">Date</label>
                                    <input id="t-info-date" class="form-control t-info-item" type="date">
                                </div>
                                <div class="col-md-6">
                                    <label for="t-info-time" class="form-label t-info-label">Time</label>
                                    <input id="t-info-time" class="form-control t-info-item" type="time" step="1">
                                </div>
                            </div>

                            <div>
                                <label for="t-info-location" class="form-label t-info-label">Location</label>
                                <input id="t-info-location" class="form-control t-info-item" type="text" placeholder="Location">
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <label for="t-info-coordinator-name" class="form-label t-info-label">Co-ordinator Name</label>
                                    <input id="t-info-coordinator-name" class="form-control t-info-item" type="text" placeholder="Co-ordinator Name"  disabled>
                                </div>
                                <div class="col-md-6">
                                    <label for="t-info-coordinator-contact" class="form-label t-info-label">Co-ordinator Contact</label>
                                    <input id="t-info-coordinator-contact" class="form-control t-info-item" type="text" placeholder="Co-ordinator Contact"  disabled>
                                </div>
                            </div>

                            <div>
                                <label for="t-info-description" class="form-label t-info-label">Description</label>
                                <div id="t-info-description" class="form-control t-info-item" contenteditable="true" role="textbox" aria-multiline="true" style="min-height:140px; overflow:auto;"></div>
                            </div>                        
                        </div>                    
                    </div>
                </div>
                <button class="btn-standard" id="t-info-edit-btn">Update Tournament Info</button>
                <button class="btn-standard" id="t-info-editCancel-btn">Cancel</button>
            </div>
        </div>

        <!-- View Tournament Info -->
        <div class="card" id="t-info-view">
            <div class="card-header">
                <h5 class="card-title">Tournament Info</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div id="t-info-icon" style="height:100%; display:flex; align-items:center; justify-content:center;">
                            <img id="t-icon-img" src="../resources/icon_theDiveClub_alpha.svg" alt="Tournament Icon">
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div id="t-info-content">
                            <div id="t-info-v-name" class="t-info-item">Tournament Name</div>
                            <div id="t-info-v-max-entries" class="t-info-item">Max Entries</div>
                            <div id="t-info-v-format" class="t-info-item">Format</div>
                            <div id="t-info-v-date" class="t-info-item">Date</div>
                            <div id="t-info-v-time" class="t-info-item">Time</div>
                            <div id="t-info-v-location" class="t-info-item">Location</div>
                            <div id="t-info-v-coordinator-name" class="t-info-item">Co-ordinator Name</div>
                            <div id="t-info-v-coordinator-contact" class="t-info-item">Co-ordinator Contact</div>
                            <div id="t-info-v-description" class="t-info-item">Description</div>
                        </div>
                    </div>
                </div>            
                <button class="btn-standard" id="t-info-editToggle-btn">Edit Tournament Info</button>
            </div>
        </div>

        <!-- Entries Control Panel -->
        <div class="card" id="t-entries-control">
            <div class="card-header">
                <h5 class="card-title">Tournament Entries - Control</h5>
            </div>
            <div class="card-body">
                <table id="tbl-entries">
                    <thead>
                        <tr>
                            <th colspan="4">
                                <label class="form-label" for="t-input-multiplePlayers">Add Mulitple Players</label>
                                <div class="input-group">
                                    <textarea id="t-input-multiplePlayers" class="form-control" placeholder="Enter Player List" rows="1" aria-label="Enter text"></textarea>
                                    <button class="btn btn-success" id="add-entries-multi-btn" aria-label="Submit">
                                        Update<br>List<br>
                                    </button>
                                </div>
                            </th>
                        </tr>
                        <tr>
                            <th colspan="4">
                                <label for="t-input-newEntry" class="form-label t-info-label">Add Single Entry</label>
                                <div class="input-group">
                                    <input id="t-input-newEntry" class="form-control" type="text" placeholder="Player Name / Username" autocomplete="off">
                                        <div class="card" id="searchResults-container" style="display: none;">
                                            <div id="searchResult" class="d-flex align-items-center px-2 py-1" style="display: none;">
                                                <img src="../resources/icon_theDiveClub_alpha.svg" alt="Player Icon" style="width:40px; height:40px; object-fit:contain;">
                                                <div class="ms-3 text-truncate" style="min-width:0;">
                                                    <span class="fw-semibold me-2">Name (Nickname)</span>
                                                    <span>@username</span>
                                                </div>
                                            </div>
                                        </div>
                                    </input>
                                    <button class="btn btn-sm btn-success" id="add-entry-btn" aria-label="Move up">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                </div>
                            </th>
                        </tr>
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Confirmed</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>Long Name XXXXXXXXXX</td>
                            <td>
                                <input class="form-check-input" type="checkbox" id="option-check">
                                <label class="form-label tag" for="option-check">#1</label>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-danger">X</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Matches Control Panel -->
        <div class="card" id="t-matches-control">
            <div class="card-header">
                <h5 class="card-title">Tournament Matches - Control</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">

                        <table id="tbl-t-rounds">                
                            <thead>
                                <th>Round</th>
                                <th>Matches</th>
                                <th>+</th>
                            </thead>

                            <tbody>
                                <tr>
                                    <td>Round 1</td>
                                    <td>0 / 8</td>
                                    <td>
                                        <button class="btn btn-sm btn-success" aria-label="New Match">
                                            <i class="bi bi-plus"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>

                            <tfoot>
                                <tr>
                                    <td colspan="5">
                                        <button id="btn-add-round" class="btn btn-sm btn-success" aria-label="New Round">
                                            <i class="bi bi-plus"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>

                        <hr class="border" role="separator" aria-orientation="horizontal" />

                        <table id="tbl-eligiblePlayers">                
                            <thead>
                                <tr>
                                    <th colspan="2">                     
                                        <div class="d-flex align-items-center">
                                            <span class="me-2">Max Players</span>
                                            <input id="t-matches-max-entries" class="form-control t-info-item" type="number" min="1" step="1" placeholder="0">
                                        </div>
                                    </th>
                                    <th>
                                        <div class="d-flex align-items-center">
                                            <span class="me-2">Lives Per Player</span>
                                            <input id="t-matches-lives-per-player" class="form-control t-info-item" type="number" min="1" step="1" placeholder="0">
                                        </div>
                                    </th>
                                </tr>
                                <tr>
                                    <th colspan="3">Eligible Players</th>
                                </tr>
                                <tr>
                                    <th>#</th>
                                    <th>Player</th>
                                    <th>Lives</th>
                                </tr>
                            </thead>

                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>Player 1</td>
                                    <td>3</td>
                                </tr>
                            </tbody>
                        </table>
                        <button id="btn-randomize-eligible" class="btn-standard">Randomize List</button>
                        <button id="btn-load-round-1" class="btn btn-success">Load Round 1</button>
                        <button id="btn-load-roundRobin" class="btn btn-success">Load Round Robin</button>
                        <button id="btn-clearAllMatches" class="btn btn-warning">Clear All Matches</button>
                    </div>

                    <div class="col-md-8">
                        <table id="tbl-t-matches">                
                            <thead>
                                <tr>
                                    <th colspan="7">Matches</th>
                                </tr>
                                <tr>
                                    <th colspan="7">    
                                        <input class="form-check-input" type="checkbox" id="option-hideCompleted">
                                        <label id="option-hideCompleted-label" class="form-label" for="option-hideCompleted">Hide Completed</label>
                                    </th>
                                </tr>
                            </thead>

                            <tbody>
                                <tr>
                                    <td colspan="6">Round 1</td>
                                </tr>
                                <tr>
                                    <td>
                                        <input class="form-check-input" type="checkbox" id="option-check">
                                    </td>
                                    <td>Player_H</td>
                                    <td><input id="m-score-H" class="form-control t-info-item" type="number" inputmode="numeric" pattern="[0-9]*" min="0" step="1" placeholder="-"></td>
                                    <td><input id="m-score-H" class="form-control t-info-item" type="number" inputmode="numeric" pattern="[0-9]*" min="0" step="1" placeholder="-"></td>
                                    <td class="cell-player-swap">Player_A <i class="bi bi-"></i></td>
                                    <td><i class="bi bi-box-arrow-up-right"></i></td>
                                    <td><button class="btn btn-sm btn-danger"><i class="bi bi-x"></i></button></td>
                                </tr>                            
                            </tbody>
                        </table>
                    </div>
                </div> 
            </div>           
        </div>

    </div>

    <!-- UI Helper -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Provide the list of card element IDs you want toggled
            const cardIds = [
                't-info-edit', 't-info-view', 't-entries-control', 't-matches-control'
            ];

            // true = expanded, false = collapsed
            const cardStates = [true, false, false, false];

            cardIds.forEach((id, cardIndex) => {
                const card = document.getElementById(id);
                if (!card) return;

                // For each .card-header inside the card, find its corresponding .card-body (assumes body is next sibling)
                const headers = card.querySelectorAll('.card-header');
                headers.forEach(header => {
                    let body = header.nextElementSibling;
                    if (!body || !body.classList.contains('card-body')) {
                        // fallback: find the first .card-body descendant
                        body = card.querySelector('.card-body');
                    }
                    if (!body) return;

                    // Make header keyboard-focusable and behave like a button for assistive tech
                    if (!header.hasAttribute('tabindex')) header.tabIndex = 0;
                    if (!header.hasAttribute('role')) header.setAttribute('role', 'button');

                    // Initialize ARIA states from cardStates array (prefer explicit state)
                    const expanded = Boolean(cardStates[cardIndex]);
                    header.setAttribute('aria-expanded', String(expanded));
                    body.setAttribute('aria-hidden', String(!expanded));
                    body.style.display = expanded ? '' : 'none';

                    const toggle = () => {
                        const isExpanded = header.getAttribute('aria-expanded') === 'true';
                        const newExpanded = !isExpanded;
                        // update attributes and style
                        header.setAttribute('aria-expanded', String(newExpanded));
                        body.setAttribute('aria-hidden', String(!newExpanded));
                        body.style.display = newExpanded ? '' : 'none';
                        // persist into cardStates
                        cardStates[cardIndex] = newExpanded;
                    };

                    header.addEventListener('click', toggle);
                    header.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ' || e.key === 'Spacebar') {
                            e.preventDefault();
                            toggle();
                        }
                    });
                });
            });
        });
    </script>

    <style>
        #tbl-entries td, #tbl-entries th, #tbl-eligiblePlayers td, #tbl-eligiblePlayers th, #tbl-t-rounds td, #tbl-t-rounds th, #tbl-t-matches th
        {
            border: 0rem solid var(--color-base-08);
            padding: 0.5rem 0.25rem;
            text-align: center;
        }

        #tbl-t-matches td
        {
            padding: 0.5rem 0.25rem;
            text-align: center;
        }
        

        #tbl-entries th
        {
            padding: 1rem;
        }

        #t-info-icon img
        {
            width: 100%;
            object-fit: contain;
            padding: 0rem;
        }

        #t-info-content
        {
            width: 100%;
            margin: 0rem;
        }

        .t-info-item
        {
            padding: 0.25rem 2rem;
            max-width: 100%;
            padding: 1rem;
        }

        .t-info-label
        {
            font-weight: bold;
            padding: 0.5rem 1rem;
        }

        .t-cell-active
        {
            background-color: rgba(0, 0, 0, 0.5);
        }

        #searchResults-container
        {
            width: 100%; 
            position: absolute; 
            left: 0%; 
            bottom: 100%;
            z-index: 100;
            margin: 0rem;
        }

        .input-score
        {
            padding: 0.25rem 0rem;
            text-align: center;
        }

        .cell-player-swap
        {
            background-color: var(--color-secondary-02);
            color: var(--color-base-10);
            border-radius: 2cap;            
        }

        .cell-player-swappable:active
        {
            background-color: var(--color-secondary-00);
            color: var(--color-base-00);
        }

        .input-complete
        {
            background-color: var(--color-base-02);
        }

        .input-win
        {
            box-shadow: 0px 0px 8px 2px var(--color-secondary-00);
        }

        #option-hideCompleted-label
        {
            text-align: left !important;
            padding: 1rem;
        }

        .cell-player-duplicate
        {
            background-color: var(--color-highlight-0) !important;
            color: var(--color-base-00) !important;
        }
    </style>

    <div id="component-siteMap"></div>

    <div id="component-footer"></div>

    <!-- Supabase -->
    <script src="../scripts/supabase/supaBase_client.js"></script>

    <!-- Accounts -->
    <script src="../scripts/accounts/login_email.js"></script>
    <script src="../scripts/accounts/login_google.js"></script>
    <script src="../scripts/accounts/signOut.js"></script>

    <!--Scripts-->
    <script src="../scripts/browserHelpers/script_includeComponents.js"></script>
    <script src="../scripts/UIControllers/nav-bar_controller.js" type="module"></script>
    
    <script src="../scripts/VFX/bg_anim_ColorGradient.js"></script>

    <script src="../scripts/tournaments/tournament_data.js" type="module"></script>

    <script src="../scripts/accounts/data_user.js" type="module"></script>
</body>
</html>